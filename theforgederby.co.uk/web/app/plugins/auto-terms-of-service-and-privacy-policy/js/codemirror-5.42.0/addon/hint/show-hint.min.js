(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(e){var i="CodeMirror-hint";var h="CodeMirror-hint-active";e.showHint=function(p,q,r){if(!q){return p.showHint(r)}if(r&&r.async){q.async=true}var s={hint:q};if(r){for(var t in r){s[t]=r[t]}}return p.showHint(s)};e.defineExtension("showHint",function(q){q=n(this,this.getCursor("start"),q);var s=this.listSelections();if(s.length>1){return}if(this.somethingSelected()){if(!q.hint.supportsSelection){return}for(var r=0;r<s.length;r++){if(s[r].head.line!=s[r].anchor.line){return}}}if(this.state.completionActive){this.state.completionActive.close()}var p=this.state.completionActive=new b(this,q);if(!p.options.hint){return}e.signal(this,"startCompletion",this);p.update(true)});function b(p,r){this.cm=p;this.options=r;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var q=this;p.on("cursorActivity",this.activityFunc=function(){q.cursorActivity()})}var k=window.requestAnimationFrame||function(p){return setTimeout(p,1000/60)};var g=window.cancelAnimationFrame||clearTimeout;b.prototype={close:function(){if(!this.active()){return}this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data){e.signal(this.data,"close")}if(this.widget){this.widget.close()}e.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(r,q){var p=r.list[q];if(p.hint){p.hint(this.cm,r,p)}else{this.cm.replaceRange(o(p),p.from||r.from,p.to||r.to,"complete")}e.signal(r,"pick",p);this.close()},cursorActivity:function(){if(this.debounce){g(this.debounce);this.debounce=0}var r=this.cm.getCursor(),p=this.cm.getLine(r.line);if(r.line!=this.startPos.line||p.length-r.ch!=this.startLen-this.startPos.ch||r.ch<this.startPos.ch||this.cm.somethingSelected()||(!r.ch||this.options.closeCharacters.test(p.charAt(r.ch-1)))){this.close()}else{var q=this;this.debounce=k(function(){q.update()});if(this.widget){this.widget.disable()}}},update:function(r){if(this.tick==null){return}var p=this,q=++this.tick;f(this.options.hint,this.cm,this.options,function(s){if(p.tick==q){p.finishUpdate(s,r)}})},finishUpdate:function(q,r){if(this.data){e.signal(this.data,"update")}var p=(this.widget&&this.widget.picked)||(r&&this.options.completeSingle);if(this.widget){this.widget.close()}this.data=q;if(q&&q.list.length){if(p&&q.list.length==1){this.pick(q,0)}else{this.widget=new m(this,q);e.signal(q,"shown")}}}};function n(p,u,r){var s=p.options.hintOptions;var q={};for(var t in c){q[t]=c[t]}if(s){for(var t in s){if(s[t]!==undefined){q[t]=s[t]}}}if(r){for(var t in r){if(r[t]!==undefined){q[t]=r[t]}}}if(q.hint.resolve){q.hint=q.hint.resolve(p,u)}return q}function o(p){if(typeof p=="string"){return p}else{return p.text}}function d(t,w){var q={Up:function(){w.moveFocus(-1)},Down:function(){w.moveFocus(1)},PageUp:function(){w.moveFocus(-w.menuSize()+1,true)},PageDown:function(){w.moveFocus(w.menuSize()-1,true)},Home:function(){w.setFocus(0)},End:function(){w.setFocus(w.length-1)},Enter:w.pick,Tab:w.pick,Esc:w.close};var v=t.options.customKeys;var s=v?{}:q;function r(x,z){var y;if(typeof z!="string"){y=function(A){return z(A,w)}}else{if(q.hasOwnProperty(z)){y=q[z]}else{y=z}}s[x]=y}if(v){for(var u in v){if(v.hasOwnProperty(u)){r(u,v[u])}}}var p=t.options.extraKeys;if(p){for(var u in p){if(p.hasOwnProperty(u)){r(u,p[u])}}}return s}function l(q,p){while(p&&p!=q){if(p.nodeName.toUpperCase()==="LI"&&p.parentNode==q){return p}p=p.parentNode}}function m(D,R){this.completion=D;this.data=R;this.picked=false;var u=this,z=D.cm;var Q=z.getInputField().ownerDocument;var P=Q.defaultView||Q.parentWindow;var L=this.hints=Q.createElement("ul");var O=D.cm.options.theme;L.className="CodeMirror-hints "+O;this.selectedHint=R.selectedHint||0;var y=R.list;for(var N=0;N<y.length;++N){var t=L.appendChild(Q.createElement("li")),s=y[N];var r=i+(N!=this.selectedHint?"":" "+h);if(s.className!=null){r=s.className+" "+r}t.className=r;if(s.render){s.render(t,R,s)}else{t.appendChild(Q.createTextNode(s.displayText||o(s)))}t.hintId=N}var x=z.cursorCoords(D.options.alignWithWord?R.from:null);var v=x.left,H=x.bottom,F=true;L.style.left=v+"px";L.style.top=H+"px";var A=P.innerWidth||Math.max(Q.body.offsetWidth,Q.documentElement.offsetWidth);var M=P.innerHeight||Math.max(Q.body.offsetHeight,Q.documentElement.offsetHeight);(D.options.container||Q.body).appendChild(L);var B=L.getBoundingClientRect(),C=B.bottom-M;var q=L.scrollHeight>L.clientHeight+1;var G=z.getScrollInfo();if(C>0){var I=B.bottom-B.top,p=x.top-(x.bottom-B.top);if(p-I>0){L.style.top=(H=x.top-I)+"px";F=false}else{if(I>M){L.style.height=(M-5)+"px";L.style.top=(H=x.bottom-B.top)+"px";var w=z.getCursor();if(R.from.ch!=w.ch){x=z.cursorCoords(w);L.style.left=(v=x.left)+"px";B=L.getBoundingClientRect()}}}}var E=B.right-A;if(E>0){if(B.right-B.left>A){L.style.width=(A-5)+"px";E-=(B.right-B.left)-A}L.style.left=(v=x.left-E)+"px"}if(q){for(var K=L.firstChild;K;K=K.nextSibling){K.style.paddingRight=z.display.nativeBarWidth+"px"}}z.addKeyMap(this.keyMap=d(D,{moveFocus:function(T,S){u.changeActive(u.selectedHint+T,S)},setFocus:function(S){u.changeActive(S)},menuSize:function(){return u.screenAmount()},length:y.length,close:function(){D.close()},pick:function(){u.pick()},data:R}));if(D.options.closeOnUnfocus){var J;z.on("blur",this.onBlur=function(){J=setTimeout(function(){D.close()},100)});z.on("focus",this.onFocus=function(){clearTimeout(J)})}z.on("scroll",this.onScroll=function(){var V=z.getScrollInfo(),U=z.getWrapperElement().getBoundingClientRect();var T=H+G.top-V.top;var S=T-(P.pageYOffset||(Q.documentElement||Q.body).scrollTop);if(!F){S+=L.offsetHeight}if(S<=U.top||S>=U.bottom){return D.close()}L.style.top=T+"px";L.style.left=(v+G.left-V.left)+"px"});e.on(L,"dblclick",function(T){var S=l(L,T.target||T.srcElement);if(S&&S.hintId!=null){u.changeActive(S.hintId);u.pick()}});e.on(L,"click",function(T){var S=l(L,T.target||T.srcElement);if(S&&S.hintId!=null){u.changeActive(S.hintId);if(D.options.completeOnSingleClick){u.pick()}}});e.on(L,"mousedown",function(){setTimeout(function(){z.focus()},20)});e.signal(R,"select",y[this.selectedHint],L.childNodes[this.selectedHint]);return true}m.prototype={close:function(){if(this.completion.widget!=this){return}this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var p=this.completion.cm;if(this.completion.options.closeOnUnfocus){p.off("blur",this.onBlur);p.off("focus",this.onFocus)}p.off("scroll",this.onScroll)},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var p=this;this.keyMap={Enter:function(){p.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(p,r){if(p>=this.data.list.length){p=r?this.data.list.length-1:0}else{if(p<0){p=r?0:this.data.list.length-1}}if(this.selectedHint==p){return}var q=this.hints.childNodes[this.selectedHint];if(q){q.className=q.className.replace(" "+h,"")}q=this.hints.childNodes[this.selectedHint=p];q.className+=" "+h;if(q.offsetTop<this.hints.scrollTop){this.hints.scrollTop=q.offsetTop-3}else{if(q.offsetTop+q.offsetHeight>this.hints.scrollTop+this.hints.clientHeight){this.hints.scrollTop=q.offsetTop+q.offsetHeight-this.hints.clientHeight+3}}e.signal(this.data,"select",this.data.list[this.selectedHint],q)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};function j(q,s){if(!q.somethingSelected()){return s}var p=[];for(var r=0;r<s.length;r++){if(s[r].supportsSelection){p.push(s[r])}}return p}function f(s,q,r,t){if(s.async){s(q,t,r)}else{var p=s(q,r);if(p&&p.then){p.then(t)}else{t(p)}}}function a(p,t){var r=p.getHelpers(t,"hint"),s;if(r.length){var q=function(u,y,v){var x=j(u,r);function w(z){if(z==x.length){return y(null)}f(x[z],u,v,function(A){if(A&&A.list.length>0){y(A)}else{w(z+1)}})}w(0)};q.async=true;q.supportsSelection=true;return q}else{if(s=p.getHelper(p.getCursor(),"hintWords")){return function(u){return e.hint.fromList(u,{words:s})}}else{if(e.hint.anyword){return function(u,v){return e.hint.anyword(u,v)}}else{return function(){}}}}}e.registerHelper("hint","auto",{resolve:a});e.registerHelper("hint","fromList",function(v,y){var w=v.getCursor(),q=v.getTokenAt(w);var r,t=e.Pos(w.line,q.start),u=w;if(q.start<w.ch&&/\w/.test(q.string.charAt(w.ch-q.start-1))){r=q.string.substr(0,w.ch-q.start)}else{r="";t=w}var x=[];for(var s=0;s<y.words.length;s++){var p=y.words[s];if(p.slice(0,r.length)==r){x.push(p)}}if(x.length){return{list:x,from:t,to:u}}});e.commands.autocomplete=e.showHint;var c={hint:e.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:true,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)});