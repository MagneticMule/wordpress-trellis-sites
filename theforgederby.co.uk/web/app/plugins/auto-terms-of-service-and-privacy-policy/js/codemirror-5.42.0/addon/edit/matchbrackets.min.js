(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(c){var d=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var f=c.Pos;var h={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function e(p,m,j){var r=p.getLineHandle(m.line),o=m.ch-1;var l=j&&j.afterCursor;if(l==null){l=/(^| )cm-fat-cursor($| )/.test(p.getWrapperElement().className)}var n=(!l&&o>=0&&h[r.text.charAt(o)])||h[r.text.charAt(++o)];if(!n){return null}var k=n.charAt(1)==">"?1:-1;if(j&&j.strict&&(k>0)!=(o==m.ch)){return null}var i=p.getTokenTypeAt(f(m.line,o+1));var q=b(p,f(m.line,o+(k>0?1:0)),k,i||null,j);if(q==null){return null}return{from:f(m.line,o),to:q&&q.pos,match:q&&q.ch==n.charAt(0),forward:k>0}}function b(v,q,m,j,l){var k=(l&&l.maxScanLineLength)||10000;var s=(l&&l.maxScanLines)||1000;var u=[];var w=l&&l.bracketRegex?l.bracketRegex:/[(){}[\]]/;var p=m>0?Math.min(q.line+s,v.lastLine()+1):Math.max(v.firstLine()-1,q.line-s);for(var n=q.line;n!=p;n+=m){var x=v.getLine(n);if(!x){continue}var t=m>0?0:x.length-1,o=m>0?x.length:-1;if(x.length>k){continue}if(n==q.line){t=q.ch-(m<0?1:0)}for(;t!=o;t+=m){var i=x.charAt(t);if(w.test(i)&&(j===undefined||v.getTokenTypeAt(f(n,t+1))==j)){var r=h[i];if((r.charAt(1)==">")==(m>0)){u.push(i)}else{if(!u.length){return{pos:f(n,t),ch:i}}else{u.pop()}}}}}return n-m==(m>0?v.lastLine():v.firstLine())?false:null}function a(s,n,m){var k=s.state.matchBrackets.maxHighlightLineLength||1000;var r=[],l=s.listSelections();for(var o=0;o<l.length;o++){var q=l[o].empty()&&e(s,l[o].head,m);if(q&&s.getLine(q.from.line).length<=k){var j=q.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";r.push(s.markText(q.from,f(q.from.line,q.from.ch+1),{className:j}));if(q.to&&s.getLine(q.to.line).length<=k){r.push(s.markText(q.to,f(q.to.line,q.to.ch+1),{className:j}))}}}if(r.length){if(d&&s.state.focused){s.focus()}var p=function(){s.operation(function(){for(var t=0;t<r.length;t++){r[t].clear()}})};if(n){setTimeout(p,800)}else{return p}}}function g(i){i.operation(function(){if(i.state.matchBrackets.currentlyHighlighted){i.state.matchBrackets.currentlyHighlighted();i.state.matchBrackets.currentlyHighlighted=null}i.state.matchBrackets.currentlyHighlighted=a(i,false,i.state.matchBrackets)})}c.defineOption("matchBrackets",false,function(i,k,j){if(j&&j!=c.Init){i.off("cursorActivity",g);if(i.state.matchBrackets&&i.state.matchBrackets.currentlyHighlighted){i.state.matchBrackets.currentlyHighlighted();i.state.matchBrackets.currentlyHighlighted=null}}if(k){i.state.matchBrackets=typeof k=="object"?k:{};i.on("cursorActivity",g)}});c.defineExtension("matchBrackets",function(){a(this,true)});c.defineExtension("findMatchingBracket",function(k,j,i){if(i||typeof j=="boolean"){if(!i){j=j?{strict:true}:null}else{i.strict=j;j=i}}return e(this,k,j)});c.defineExtension("scanForBracket",function(l,j,k,i){return b(this,l,j,k,i)})});