(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(e){var d={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"};var k=e.Pos;e.defineOption("autoCloseBrackets",false,function(o,q,p){if(p&&p!=e.Init){o.removeKeyMap(j);o.state.closeBrackets=null}if(q){h(a(q,"pairs"));o.state.closeBrackets=q;o.addKeyMap(j)}});function a(p,o){if(o=="pairs"&&typeof p=="string"){return p}if(typeof p=="object"&&p[o]!=null){return p[o]}return d[o]}var j={Backspace:c,Enter:b};function h(r){for(var p=0;p<r.length;p++){var q=r.charAt(p),o="'"+q+"'";if(!j[o]){j[o]=n(q)}}}h(d.pairs+"`");function n(o){return function(p){return m(p,o)}}function l(o){var q=o.state.closeBrackets;if(!q||q.override){return q}var p=o.getModeAt(o.getCursor());return p.closeBrackets||q}function c(o){var q=l(o);if(!q||o.getOption("disableInput")){return e.Pass}var t=a(q,"pairs");var p=o.listSelections();for(var r=0;r<p.length;r++){if(!p[r].empty()){return e.Pass}var s=g(o,p[r].head);if(!s||t.indexOf(s)%2!=0){return e.Pass}}for(var r=p.length-1;r>=0;r--){var u=p[r].head;o.replaceRange("",k(u.line,u.ch-1),k(u.line,u.ch+1),"+delete")}}function b(o){var q=l(o);var s=q&&a(q,"explode");if(!s||o.getOption("disableInput")){return e.Pass}var p=o.listSelections();for(var r=0;r<p.length;r++){if(!p[r].empty()){return e.Pass}var t=g(o,p[r].head);if(!t||s.indexOf(t)%2!=0){return e.Pass}}o.operation(function(){var v=o.lineSeparator()||"\n";o.replaceSelection(v+v,null);o.execCommand("goCharLeft");p=o.listSelections();for(var w=0;w<p.length;w++){var u=p[w].head.line;o.indentLine(u,null,true);o.indentLine(u+1,null,true)}})}function f(p){var o=e.cmpPos(p.anchor,p.head)>0;return{anchor:new k(p.anchor.line,p.anchor.ch+(o?-1:1)),head:new k(p.head.line,p.head.ch+(o?1:-1))}}function m(v,x){var w=l(v);if(!w||v.getOption("disableInput")){return e.Pass}var F=a(w,"pairs");var u=F.indexOf(x);if(u==-1){return e.Pass}var C=a(w,"triples");var o=F.charAt(u+1)==x;var p=v.listSelections();var A=u%2==0;var r;for(var D=0;D<p.length;D++){var y=p[D],q=y.head,t;var B=v.getRange(q,k(q.line,q.ch+1));if(A&&!y.empty()){t="surround"}else{if((o||!A)&&B==x){if(o&&i(v,q)){t="both"}else{if(C.indexOf(x)>=0&&v.getRange(q,k(q.line,q.ch+3))==x+x+x){t="skipThree"}else{t="skip"}}}else{if(o&&q.ch>1&&C.indexOf(x)>=0&&v.getRange(k(q.line,q.ch-2),q)==x+x){if(q.ch>2&&/\bstring/.test(v.getTokenTypeAt(k(q.line,q.ch-2)))){return e.Pass}t="addFour"}else{if(o){var z=q.ch==0?" ":v.getRange(k(q.line,q.ch-1),q);if(!e.isWordChar(B)&&z!=x&&!e.isWordChar(z)){t="both"}else{return e.Pass}}else{if(A){t="both"}else{return e.Pass}}}}}if(!r){r=t}else{if(r!=t){return e.Pass}}}var s=u%2?F.charAt(u-1):x;var E=u%2?x:F.charAt(u+1);v.operation(function(){if(r=="skip"){v.execCommand("goCharRight")}else{if(r=="skipThree"){for(var H=0;H<3;H++){v.execCommand("goCharRight")}}else{if(r=="surround"){var G=v.getSelections();for(var H=0;H<G.length;H++){G[H]=s+G[H]+E}v.replaceSelections(G,"around");G=v.listSelections().slice();for(var H=0;H<G.length;H++){G[H]=f(G[H])}v.setSelections(G)}else{if(r=="both"){v.replaceSelection(s+E,null);v.triggerElectric(s+E);v.execCommand("goCharLeft")}else{if(r=="addFour"){v.replaceSelection(s+s+s+s,"before");v.execCommand("goCharRight")}}}}}})}function g(o,q){var p=o.getRange(k(q.line,q.ch-1),k(q.line,q.ch+1));return p.length==2?p:null}function i(o,q){var p=o.getTokenAt(k(q.line,q.ch+1));return/\bstring/.test(p.type)&&p.start==q.ch&&(q.ch==0||!/\bstring/.test(o.getTokenTypeAt(q)))}});