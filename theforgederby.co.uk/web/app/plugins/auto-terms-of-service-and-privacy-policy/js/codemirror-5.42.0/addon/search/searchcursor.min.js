(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(d){var l=d.Pos;function f(r){var q=r.flags;return q!=null?q:(r.ignoreCase?"i":"")+(r.global?"g":"")+(r.multiline?"m":"")}function e(s,q){var u=f(s),t=u;for(var r=0;r<q.length;r++){if(t.indexOf(q.charAt(r))==-1){t+=q.charAt(r)}}return u==t?s:new RegExp(s.source,t)}function o(q){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(q.source)}function n(w,v,x){v=e(v,"g");for(var q=x.line,t=x.ch,u=w.lastLine();q<=u;q++,t=0){v.lastIndex=t;var s=w.getLine(q),r=v.exec(s);if(r){return{from:l(q,r.index),to:l(q,r.index+r[0].length),match:r}}}}function g(A,x,r){if(!o(x)){return n(A,x,r)}x=e(x,"gm");var w,z=1;for(var D=r.line,B=A.lastLine();D<=B;){for(var u=0;u<z;u++){if(D>B){break}var q=A.getLine(D++);w=w==null?q:w+"\n"+q}z=z*2;x.lastIndex=r.ch;var v=x.exec(w);if(v){var y=w.slice(0,v.index).split("\n"),t=v[0].split("\n");var C=r.line+y.length-1,s=y[y.length-1].length;return{from:l(C,s),to:l(C+t.length-1,t.length==1?s+t[0].length:t[t.length-1].length),match:v}}}}function h(r,t){var u=0,q;for(;;){t.lastIndex=u;var s=t.exec(r);if(!s){return q}q=s;u=q.index+(q[0].length||1);if(u==r.length){return q}}}function c(v,u,x){u=e(u,"g");for(var q=x.line,t=x.ch,w=v.firstLine();q>=w;q--,t=-1){var s=v.getLine(q);if(t>-1){s=s.slice(0,t)}var r=h(s,u);if(r){return{from:l(q,r.index),to:l(q,r.index+r[0].length),match:r}}}}function i(B,y,r){y=e(y,"gm");var x,A=1;for(var D=r.line,w=B.firstLine();D>=w;){for(var u=0;u<A;u++){var q=B.getLine(D--);x=x==null?q.slice(0,r.ch):q+"\n"+x}A*=2;var v=h(x,y);if(v){var z=x.slice(0,v.index).split("\n"),t=v[0].split("\n");var C=D+z.length,s=z[z.length-1].length;return{from:l(C,s),to:l(C+t.length-1,t.length==1?s+t[0].length:t[t.length-1].length),match:v}}}}var p,a;if(String.prototype.normalize){p=function(q){return q.normalize("NFD").toLowerCase()};a=function(q){return q.normalize("NFD")}}else{p=function(q){return q.toLowerCase()};a=function(q){return q}}function m(x,v,w,t){if(x.length==v.length){return w}for(var u=0,r=w+Math.max(0,x.length-v.length);;){if(u==r){return u}var s=(u+r)>>1;var q=t(x.slice(0,s)).length;if(q==w){return s}else{if(q>w){r=s}else{u=s+1}}}}function k(C,y,r,u){if(!y.length){return null}var w=u?p:a;var F=w(y).split(/\r|\n\r?/);search:for(var G=r.line,q=r.ch,D=C.lastLine()+1-F.length;G<=D;G++,q=0){var B=C.getLine(G).slice(q),v=w(B);if(F.length==1){var E=v.indexOf(F[0]);if(E==-1){continue search}var r=m(B,v,E,w)+q;return{from:l(G,m(B,v,E,w)+q),to:l(G,m(B,v,E+F[0].length,w)+q)}}else{var x=v.length-F[0].length;if(v.slice(x)!=F[0]){continue search}for(var t=1;t<F.length-1;t++){if(w(C.getLine(G+t))!=F[t]){continue search}}var s=C.getLine(G+F.length-1),A=w(s),z=F[F.length-1];if(A.slice(0,z.length)!=z){continue search}return{from:l(G,m(B,v,x,w)+q),to:l(G+F.length-1,m(s,A,z.length,w))}}}}function b(C,y,r,t){if(!y.length){return null}var x=t?p:a;var E=x(y).split(/\r|\n\r?/);search:for(var F=r.line,q=r.ch,u=C.firstLine()-1+E.length;F>=u;F--,q=-1){var B=C.getLine(F);if(q>-1){B=B.slice(0,q)}var v=x(B);if(E.length==1){var D=v.lastIndexOf(E[0]);if(D==-1){continue search}return{from:l(F,m(B,v,D,x)),to:l(F,m(B,v,D+E[0].length,x))}}else{var A=E[E.length-1];if(v.slice(0,A.length)!=A){continue search}for(var s=1,r=F-E.length+1;s<E.length-1;s++){if(x(C.getLine(r+s))!=E[s]){continue search}}var z=C.getLine(F+1-E.length),w=x(z);if(w.slice(w.length-E[0].length)!=E[0]){continue search}return{from:l(F+1-E.length,m(z,w,z.length-E[0].length,x)),to:l(F,m(B,v,A.length,x))}}}}function j(t,s,u,q){this.atOccurrence=false;this.doc=t;u=u?t.clipPos(u):l(0,0);this.pos={from:u,to:u};var r;if(typeof q=="object"){r=q.caseFold}else{r=q;q=null}if(typeof s=="string"){if(r==null){r=false}this.matches=function(v,w){return(v?b:k)(t,s,w,r)}}else{s=e(s,"gm");if(!q||q.multiline!==false){this.matches=function(v,w){return(v?i:g)(t,s,w)}}else{this.matches=function(v,w){return(v?c:n)(t,s,w)}}}}j.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(s){var q=this.matches(s,this.doc.clipPos(s?this.pos.from:this.pos.to));while(q&&d.cmpPos(q.from,q.to)==0){if(s){if(q.from.ch){q.from=l(q.from.line,q.from.ch-1)}else{if(q.from.line==this.doc.firstLine()){q=null}else{q=this.matches(s,this.doc.clipPos(l(q.from.line-1)))}}}else{if(q.to.ch<this.doc.getLine(q.to.line).length){q.to=l(q.to.line,q.to.ch+1)}else{if(q.to.line==this.doc.lastLine()){q=null}else{q=this.matches(s,l(q.to.line+1,0))}}}}if(q){this.pos=q;this.atOccurrence=true;return this.pos.match||true}else{var r=l(s?this.doc.firstLine():this.doc.lastLine()+1,0);this.pos={from:r,to:r};return this.atOccurrence=false}},from:function(){if(this.atOccurrence){return this.pos.from}},to:function(){if(this.atOccurrence){return this.pos.to}},replace:function(s,r){if(!this.atOccurrence){return}var q=d.splitLines(s);this.doc.replaceRange(q,this.pos.from,this.pos.to,r);this.pos.to=l(this.pos.from.line+q.length-1,q[q.length-1].length+(q.length==1?this.pos.from.ch:0))}};d.defineExtension("getSearchCursor",function(r,s,q){return new j(this.doc,r,s,q)});d.defineDocExtension("getSearchCursor",function(r,s,q){return new j(this,r,s,q)});d.defineExtension("selectMatches",function(s,r){var q=[];var t=this.getSearchCursor(s,this.getCursor("from"),r);while(t.findNext()){if(d.cmpPos(t.to(),this.getCursor("to"))>0){break}q.push({anchor:t.from(),head:t.to()})}if(q.length){this.setSelections(q,0)}})});