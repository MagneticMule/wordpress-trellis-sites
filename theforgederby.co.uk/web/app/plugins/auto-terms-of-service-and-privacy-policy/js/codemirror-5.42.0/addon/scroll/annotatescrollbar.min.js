(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineExtension("annotateScrollbar",function(c){if(typeof c=="string"){c={className:c}}return new b(this,c)});a.defineOption("scrollButtonHeight",0);function b(c,e){this.cm=c;this.options=e;this.buttonHeight=e.scrollButtonHeight||c.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=c.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();function f(g){clearTimeout(d.doRedraw);d.doRedraw=setTimeout(function(){d.redraw()},g)}var d=this;c.on("refresh",this.resizeHandler=function(){clearTimeout(d.doUpdate);d.doUpdate=setTimeout(function(){if(d.computeScale()){f(20)}},100)});c.on("markerAdded",this.resizeHandler);c.on("markerCleared",this.resizeHandler);if(e.listenForChanges!==false){c.on("change",this.changeHandler=function(){f(250)})}}b.prototype.computeScale=function(){var c=this.cm;var d=(c.getWrapperElement().clientHeight-c.display.barHeight-this.buttonHeight*2)/c.getScrollerElement().scrollHeight;if(d!=this.hScale){this.hScale=d;return true}};b.prototype.update=function(c){this.annotations=c;this.redraw()};b.prototype.redraw=function(n){if(n!==false){this.computeScale()}var h=this.cm,t=this.hScale;var d=document.createDocumentFragment(),f=this.annotations;var j=h.getOption("lineWrapping");var s=j&&h.defaultTextHeight()*1.5;var k=null,r=null;function q(w,v){if(k!=w.line){k=w.line;r=h.getLineHandle(k)}if((r.widgets&&r.widgets.length)||(j&&r.height>s)){return h.charCoords(w,"local")[v?"top":"bottom"]}var i=h.heightAtLine(r,"local");return i+(v?0:r.height)}var c=h.lastLine();if(h.display.barWidth){for(var o=0,u;o<f.length;o++){var p=f[o];if(p.to.line>c){continue}var l=u||q(p.from,true)*t;var g=q(p.to,false)*t;while(o<f.length-1){if(f[o+1].to.line>c){break}u=q(f[o+1].from,true)*t;if(u>g+0.9){break}p=f[++o];g=q(p.to,false)*t}if(g==l){continue}var m=Math.max(g-l,3);var e=d.appendChild(document.createElement("div"));e.style.cssText="position: absolute; right: 0px; width: "+Math.max(h.display.barWidth-1,2)+"px; top: "+(l+this.buttonHeight)+"px; height: "+m+"px";e.className=this.options.className;if(p.id){e.setAttribute("annotation-id",p.id)}}}this.div.textContent="";this.div.appendChild(d)};b.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);if(this.changeHandler){this.cm.off("change",this.changeHandler)}this.div.parentNode.removeChild(this.div)}});