!function(a){"use strict";a(function(){function b(a){this.button=a}function c(a){this.container=a}function d(a){this.id=a.attr("data-dummy-id"),this.title=a.find("h3").first().text(),this.url=z(a.find(".dt-dummy-screenshot a").first().attr("href")),this.tags=JSON.parse(a.attr("data-tags")),this.container=a,this.settings=a.find(".dt-dummy-field input"),this.errors=new c(a.find(".the7-demo-notifications")),this.buttons={import:new b(a.find(".dt-dummy-button-import")),onePageImport:new b(a.find(".dt-dummy-button-import-one-page")),remove:new b(a.find(".dt-remove-content-button")),keep:new b(a.find(".dt-keep-content-button"))},this.addEvents()}function e(b,c,d){return b.then(function(){var b=x(c);return void 0===d&&(d=o(b,F)),a.post(ajaxurl,c).then(B).done(function(c){d.replaceWith(a('<p class="the7-updated">'+b+"</p>"))}).fail(function(){d.replaceWith(a('<p class="the7-error">'+b+"</p>"))})})}function f(a,b){return a.then(function(){var a=x(b),c=o(a,F);return n(b,c)})}function g(b,c,d){var e=H,f=d.plugins_to_install,g=d.plugins_to_activate,h=dtDummy.plugins_page_url,i=dtDummy.strings.plugins_installation_error;return g||f?(e.beforePluginsInstallation(a.merge([],f,g)),f.forEach(function(c){b=b.then(function(){var b=c;return void 0!==dtDummy.plugins[c]&&(b=dtDummy.plugins[c]),e.onActionStart(dtDummy.strings.installing_plugin+" "+b),a.post(h,{action:"tgmpa-bulk-install",just_install:!0,noheader:!0,plugin:c}).then(function(b){var c=a.Deferred();return a(b).find(".update-php div.error p").length>0?c.reject(b):c.resolve(b),c.promise()}).done(function(b){var c=a(b).find(".update-php div.updated p");c.find(".js-update-details-toggle").remove(),e.onActionDone(c.text())}).fail(function(b){var d=a(b).find(".update-php div.error p");e.onActionFail(d.length?d.text():i,c)})})}),b=b.then(function(){return e.onActionStart(dtDummy.strings.activating_plugin),a.merge(g,f),a.post(h,{action:"tgmpa-bulk-activate",noheader:!0,plugin:g}).done(function(a){e.onActionDone(dtDummy.strings.plugins_activated)}).fail(function(){e.onActionFail(i)})}),b=b.then(function(){return e.onActionStart(dtDummy.strings.rid_of_redirects),a.get(h,{noheader:!0}).done(function(){e.onActionDone(dtDummy.strings.rid_of_redirects)}).fail(function(){e.onActionFail(i)})})):b}function h(b,c,d){return j(b,a.extend({},c,{provided_url:d.provided_url}))}function i(b,c,d){return j(b,a.extend({},c,{post_to_import:d.post_to_import}))}function j(b,c,d){return b.then(function(){var d=x(c),f=o(d,F);return a.post(ajaxurl,c).then(B).done(function(g){var h=g.data.step2Links;return f.replaceWith(a('<p class="the7-updated">'+d+"</p>")),g.data.postImportActions.forEach(function(d){var f=a.extend({},c,{dummy:d,imported_post_id:g.data.imported_post_id});if(I.hasOwnProperty(d))return void(b=I[d](b,f,the7ImportData));b=e(b,f)}),b.done(function(b){a("#the7-demo-visit-site-link").replaceWith(h)}),b}).fail(function(){f.replaceWith(a('<p class="the7-error">'+d+"</p>"))})})}function k(a,b,c){return e(a,{action:"the7_remove_demo_content",_wpnonce:dtDummy.remove_demo_nonce,demo:c.demo_id,dummy:"remove_content"}).always(A)}function l(a,b,c){return e(a,{action:"the7_keep_demo_content",_wpnonce:dtDummy.nonces.keep_demo_content,demo:c.demo_id,dummy:"keep_content"}).always(A)}function m(a,b,c){return e(a,b).always(A)}function n(b,c){return a.post(ajaxurl,b).then(B).then(function(d){var e=x({dummy:"import_attachments"})+" ("+d.data.imported+"/"+d.data.total+")";return e===c.text().trim()?B(null):0!=d.data.left?n(b,y(c,o(e))):void c.replaceWith(a('<p class="the7-updated">'+x(b)+"</p>"))}).fail(function(){c.replaceWith(a('<p class="the7-error">'+x(b)+"</p>"))})}function o(b,c){var d=a('<p><span class="spinner is-active" style="float: none; margin: 0"></span> '+b+"</p>");return void 0!==c&&c.append(d),d}function p(b){var c=b.find("select.dt-dummy-content-post-type");c.html(""),a.each(D,function(a,b){c.append('<option id="'+a+'"  value="'+a+'">'+a+"</option>")}),r(b)}function q(b,c){var d=c.find("select.dt-dummy-content-posts");d.empty(),a.each(D[b],function(a,b){d.append('<option id="'+a+'"  value="'+a+'">'+b.post_title+"</option>")}),r(c)}function r(a){var b=a.find("select.dt-dummy-content-posts").val(),c=a.find("select.dt-dummy-content-post-type").val(),d=a.find(".dt-dummy-one-post-url");if(null==b||null==c)return void d.hide();d.attr("href",D[c][b].url),d.show()}function s(a){a.empty(),a.hide();var b='<div class="dt-dummy-controls-block" style="padding-bottom: 1em;"><table class="dt-dummy-field dt-dummy-one-post-data"><tr><td>'+dtDummy.strings.one_post_importing_choose_posttype+': </td><td><select name="the7_import_post_type" id="post-type" class="dt-dummy-content-post-type"></select></td></tr><tr><td>'+dtDummy.strings.one_post_importing_choose_post+': </td><td><select name="the7_import_post_id" id="posts" class="dt-dummy-content-posts"></select> <a class="the7-tip dt-dummy-one-post-url" href="#" target="_blank">'+dtDummy.strings.one_post_importing_url_msg+"</a></td></tr></table></div>",c='<div class="dt-dummy-controls-block dt-dummy-control-buttons"><div class="dt-dummy-button-wrap"><button type="submit" class="button button-primary dt-dummy-button-import-one-page-submit">'+dtDummy.strings.one_post_importing_import+"</button></div></div>";void 0!==a&&(a.append(b),a.append(c))}function t(b){return[a(".dt-dummy-content-user",b).first().val()]}function u(a,b){var c=a.attr("data-dummy-id")||"0";void 0===C||c===E&&!b||(C.slideDown(),C.parent().find(".dt-dummy-one-page-importing-interface").remove()),E=c}function v(){var b=a("#full-site-group"),c=b.find("button").not(":disabled");b.data("the7ButtonsToEnable",c),c.prop("disabled","disabled"),K.blockTabs()}function w(){var b=a("#full-site-group"),c=b.data("the7ButtonsToEnable");b.removeData("the7ButtonsToEnable"),c&&c.length&&(c.removeAttr("disabled"),K.unblockTabs())}function x(a){var b=a.dummy;return void 0!==dtDummy.strings[a.dummy]&&(b=dtDummy.strings[a.dummy]),b}function y(a,b){return a.replaceWith(b),b}function z(a){return"https://"+a.replace(/[\?#].*/,"").replace(/\/?$/,"/").replace("https://","")}function A(){a(".the7-go-back-link").removeClass("hide-if-js")}function B(b){var c=a.Deferred();return b.success?c.resolve(b):c.reject(b),c.promise()}var C,D=null,E=null,F=a(".the7-import-feedback"),G=a(".dt-dummy-content"),H={feedback:null,beforePluginsInstallation:function(){},onActionStart:function(a){this.feedback=o(a,F)},onActionDone:function(b){this.feedback.replaceWith(a('<p class="the7-updated">'+b+"</p>"))},onActionFail:function(b){this.feedback.replaceWith(a('<p class="the7-error">'+b+"</p>"))}},I={import_attachments:f,install_plugins:g,import_by_url:h,import_one_post:i,remove_content:k,keep_content:l,cleanup:m},J=function(){function b(b,c){this.insertAfterObj=a(c),this.noticeID=b,this.noticeTplObj=a('<div id="'+b+'" class="the7-dashboard-notice the7-notice notice is-dismissible"></div>'),a("body").on("click","#"+b+" .notice-dismiss",function(){a("#"+b).remove()})}return b.prototype.addError=function(b,c){if(!b)return a();a("html, body").animate({scrollTop:0},400);return this.noticeTplObj.clone().html(b+'<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button>').addClass(c).insertAfter(this.insertAfterObj)},b.prototype.removeErrors=function(){a("#"+this.noticeID).remove()},b.prototype.prepareMsg=function(a){return"<p><strong>"+a+"</strong></p>"},b.prototype.addMsg=function(a,b){return this.addError(this.prepareMsg(a),b)},b}(),K=(new J("the7-demo-content-error",".wrap > .wp-header-end"),{bootstrap:function(){var b=this;a(".nav-tab-wrapper").show(),this.showOptionsTab(a(".nav-tab-wrapper a.nav-tab-active").attr("id")),a(".tabs-holder").removeClass("hidden"),a(".nav-tab-wrapper a").on("click.the7.tabs",function(a){b.onTabClick(a,this)}),a(window).on("popstate.the7.tabs",this.onPopstate.bind(this))},convertTab2Group:function(a){return a.replace("-tab","-group")},showOptionsTab:function(b){if(b){var c=this.convertTab2Group(b);a(".group").hide().filter("#"+c).fadeIn(),a(".nav-tab-wrapper a").removeClass("nav-tab-active").filter("#"+b).addClass("nav-tab-active").blur()}},onTabClick:function(b,c){b.preventDefault();var d=a(c);if(d.hasClass("blocked"))return!1;var e=d.attr("id");return this.showOptionsTab(e),history.pushState({activeGroupId:"#"+this.convertTab2Group(e)},"",d.attr("href")),!1},onPopstate:function(b){var c={};if(location.search.substr(1).split("&").forEach(function(a){c[a.split("=")[0]]=a.split("=")[1]}),c.tab)var d=c.tab;else var d=a(".nav-tab-wrapper a").first().attr("id");this.showOptionsTab(d)},blockTabs:function(){a(".nav-tab-wrapper a").removeClass("blocked").addClass("blocked")},unblockTabs:function(){a(".nav-tab-wrapper a").removeClass("blocked")}});K.bootstrap(),"undefined"!=typeof the7ImportData&&function(){var b=the7ImportData.actions,d=a.when();b.forEach(function(a){var b={action:"the7_import_demo_content",dummy:a,content_part_id:the7ImportData.demo_id,user_map:the7ImportData.users,imported_authors:["admin"],_wpnonce:dtDummy.import_nonce,import_type:the7ImportData.import_type||"full_import"};if(I.hasOwnProperty(a))return void(d=I[a](d,b,the7ImportData));d=e(d,b)}),d.fail(function(b){var d=new c(F);void 0!==b.data&&void 0!==b.data.error_msg&&b.data.error_msg?d.addText(b.data.error_msg):d.addPHPStatus(),a(".the7-go-back-link").html(dtDummy.strings.go_back_with_error),A()})}(),a(".dt-dummy-control-buttons .dt-dummy-button-import-one-page").on("click",function(b){var c=a(this),d=c.closest(".dt-dummy-content"),f=d.data("the7Demo"),g=t(d),h=a.when();b.preventDefault(),f.errors.clear(),f.buttons.onePageImport.setBusy(dtDummy.strings.loading),v(),u(d,!1),["download_package","get_posts"].forEach(function(a){h=e(h,{action:"the7_import_demo_content",_wpnonce:dtDummy.import_nonce,dummy:a,user_map:g,content_part_id:f.id})}),h.done(function(b){void 0!==b.data&&void 0!==b.data.response&&"getPostsList"===b.data.response&&(D=b.data.data,C=c.closest(".dt-dummy-controls-block-import-one-page"),C.slideUp(400,function(){var b=a('<div class="dt-dummy-one-page-importing-interface"></div>');C.after(b),s(b),p(b),b.slideDown(),q(b.find("select.dt-dummy-content-post-type").val(),b),b.find("select.dt-dummy-content-post-type").on("change",function(a){q(this.value,b)}),b.find("select.dt-dummy-content-posts").on("change",function(a){r(b)})}))}),h.fail(function(a){void 0!==a.data&&void 0!==a.data.error_msg&&a.data.error_msg?f.errors.addText(a.data.error_msg):f.errors.addPHPStatus()}),h.always(function(){w(),f.buttons.onePageImport.setFree()})}),a(".the7-demo-quick-search .the7-demo-tag").on("click",function(){var b=a(this).attr("data-tag"),c=a("#dt-dummy-search-input");c.val(c.val()+" "+b+" ").trigger("search").focus()}),a("#dt-dummy-search-input").on("search keyup",function(){var b=a(this).val().toLowerCase(),c=b.split(" ");1!==b.length&&G.filter(function(a,b){return!0}).each(function(){var d=a(this),e=d.data("the7Demo"),f=!1,g=e.title.toLowerCase()+" "+e.tags.join(" ").toLowerCase();c.every(function(a){return g.includes(a)})?f=!0:e.url.toLowerCase().includes(z(b))&&(f=!0),f?d.show():d.hide()})}),a(".dt-remove-content-button").on("click",function(a){window.confirm(dtDummy.strings.remove_content_confirm)||a.preventDefault()}),a(".dt-keep-content-button").on("click",function(a){window.confirm(dtDummy.strings.keep_content_confirm)||a.preventDefault()}),b.prototype.disable=function(){this.button.prop("disabled",!0)},b.prototype.enable=function(){this.button.prop("disabled",!1)},b.prototype.setBusy=function(a){this.setFree(),this.button.addClass("button--importing").prop("disabled",!0),void 0!==a&&(this.button.data("the7ButtonOriginCaption",this.button.text()),this.button.text(a)),this.button.siblings(".spinner").first().addClass("is-active")},b.prototype.setFree=function(a){var b=this.button.data("the7ButtonOriginCaption");this.button.siblings(".spinner").first().removeClass("is-active"),this.button.removeClass("button--importing").prop("disabled",!1),b&&this.button.text(b)},c.prototype.addText=function(a){this.add("<p>"+a+"</p>")},c.prototype.add=function(b){var c=a('<div class="dt-dummy-inline-msg hide-if-js inline error">'+b+"</div>");this.container.append(c),c.slideDown()},c.prototype.clear=function(){this.container.slideUp().html("")},c.prototype.addPHPStatus=function(){var b=this;a.post(ajaxurl,{action:"the7_demo_content_php_status",_wpnonce:dtDummy.status_nonce}).then(B).done(function(a){a.data?b.add(a.data):b.addText(dtDummy.strings.msg_import_fail)}).fail(function(){b.addText(dtDummy.strings.msg_import_fail)})},d.prototype.addEvents=function(){var b=this;this.settings.on("change",function(){var c=a(this),d=c.data("affectedSettings")||b.container.find(".dt-dummy-field :input").not("[name=install_plugins], [name=import_theme_options], :disabled");"install_plugins"===c.attr("name")&&(c.data("affectedSettings",d),c.is(":checked")?(d.removeAttr("disabled").parents(".dt-dummy-field").removeClass("disabled"),c.removeData("affectedSettings")):d.attr("disabled","disabled").parents(".dt-dummy-field").addClass("disabled")),b.maybeChangeImportButtonState()})},d.prototype.getActions=function(){var b=[];return this.settings.filter(":checked").not(":disabled").each(function(){b.push(a(this).attr("name"))}),b.indexOf("import_theme_options")>=0&&(b=b.filter(function(a){return"import_theme_options"!==a}),b.push("import_theme_options")),b},d.prototype.maybeChangeImportButtonState=function(){this.getActions().filter(function(a){return"install_plugins"!==a}).length?this.buttons.import.enable():this.buttons.import.disable()},G.each(function(){var b=a(this);b.data("the7Demo",new d(b))})})}(jQuery);